<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoLister - Scrape Queue</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/scrape-queue.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">AutoLister</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/passive-income">Passive Income</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/scrape-queue">Scrape Queue</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <h2><i class="bi bi-list-task"></i> Scrape Job Queue</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newJobModal">
                        <i class="bi bi-plus-lg"></i> New Scrape Job
                    </button>
                </div>
            </div>
        </div>

        <!-- Queue Stats -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Queued Jobs</h5>
                        <h2 class="stat-number" id="queued-jobs">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card info">
                    <div class="card-body text-center">
                        <h5 class="card-title">Scheduled Jobs</h5>
                        <h2 class="stat-number" id="scheduled-jobs">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card success">
                    <div class="card-body text-center">
                        <h5 class="card-title">Completed Jobs</h5>
                        <h2 class="stat-number" id="completed-jobs">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card danger">
                    <div class="card-body text-center">
                        <h5 class="card-title">Failed Jobs</h5>
                        <h2 class="stat-number" id="failed-jobs">0</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Scrape Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card" id="current-scrape-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-activity"></i> Current Scrape Status</h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="refreshCurrentScrape()">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="current-scrape-container">
                            <div class="text-center text-muted py-4">
                                <i class="bi bi-pause-circle fs-1"></i>
                                <p class="mt-2">No scrape job currently running</p>
                            </div>
                        </div>
                    </div>
                    <!-- Scraping Logs Section -->
                    <div class="card-footer" id="scrape-logs-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0"><i class="bi bi-terminal"></i> Scraping Logs</h6>
                            <button class="btn btn-sm btn-outline-secondary" onclick="toggleLogs()">
                                <i class="bi bi-chevron-down" id="logs-toggle-icon"></i>
                            </button>
                        </div>
                        <div id="scrape-logs" class="scrape-logs">
                            <div class="text-muted">No logs yet. Start a scrape job to see output.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Queue List -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-list-ul"></i> Job Queue</h5>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-secondary" onclick="toggleAutostart()" id="autostart-toggle-btn">
                                <i class="bi bi-play-circle"></i> Autostart: <span id="autostart-status">Off</span>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="refreshQueue()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="queue-container">
                            <div class="text-center text-muted py-4">
                                <i class="bi bi-inbox fs-1"></i>
                                <p class="mt-2">No jobs in queue. Create a new scrape job to get started.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Job Modal -->
    <div class="modal fade" id="newJobModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-plus-circle"></i> New Scrape Job</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Info Message Box -->
                    <div class="alert alert-info d-flex align-items-start mb-3" role="alert">
                        <i class="bi bi-info-circle-fill me-2 fs-5"></i>
                        <div>
                            <strong>How Job Configuration Works</strong>
                            <p class="mb-2 mt-1">There are two ways to create a scrape job:</p>
                            <ul class="mb-0">
                                <li><strong>Manual Config</strong> - Manually configure all scraping parameters including search queries, sites to crawl, file filters, and crawling behavior. Use this when you know exactly what you want to scrape.</li>
                                <li><strong>AI Generate</strong> - Describe what you want to scrape in plain English and the AI will intelligently populate ALL configuration fields with optimal values for your specific use case. Great for quickly setting up targeted scraping jobs.</li>
                            </ul>
                            <hr class="my-2">
                            <p class="mb-0 small"><strong>Key Settings:</strong> Search terms filter what documents to include. Exclude terms filter out unwanted files. Min pages helps skip short previews. Max depth controls how deep the scraper follows links. File extensions determine which file types to look for (default: PDF).</p>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    <ul class="nav nav-tabs mb-3" id="jobConfigTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual" type="button" role="tab">
                                <i class="bi bi-sliders"></i> Manual Config
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ai-tab" data-bs-toggle="tab" data-bs-target="#ai" type="button" role="tab">
                                <i class="bi bi-magic"></i> AI Generate
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="jobConfigTabsContent">
                        <!-- Manual Configuration Tab -->
                        <div class="tab-pane fade show active" id="manual" role="tabpanel">
                            <form id="manualJobForm">
                                <div class="mb-3">
                                    <label class="form-label">Job Name</label>
                                    <input type="text" class="form-control" id="jobName" value="Service Manuals Collection" placeholder="e.g., Vintage Camera Manuals">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Source Type</label>
                                    <select class="form-select" id="sourceType" onchange="toggleMultiSiteFields()">
                                        <option value="multi_site" selected>Multi-Site Scraper (DuckDuckGo + Traversal)</option>
                                        <option value="search">Search Engine</option>
                                        <option value="forum">Forums</option>
                                        <option value="manual_site">Manual Sites</option>
                                        <option value="gdrive">Google Drive</option>
                                    </select>
                                </div>
                                <!-- Multi-Site Fields -->
                                <div id="multiSiteFields" style="display: block;">
                                    <div class="mb-3">
                                        <label class="form-label">DuckDuckGo Search Query (to find sites)</label>
                                        <input type="text" class="form-control" id="ddgSearchQuery" value="service manual filetype:pdf -preview -operator -operation -user -owner -quick start -brochure" placeholder="e.g., vintage camera manual filetype:pdf">
                                        <div class="form-text">DuckDuckGo will find surface sites, then we'll traverse through those sites to find PDFs in open directories.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Additional Sites to Scrape (one per line, optional)</label>
                                        <textarea class="form-control" id="sites" rows="4" placeholder="https://example.com/manuals&#10;https://another-site.com/documents&#10;https://manual-archive.com"></textarea>
                                        <div class="form-text">Enter additional URLs to scrape. The scraper will crawl each site concurrently along with sites found from DuckDuckGo.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">File Extensions (comma-separated)</label>
                                        <input type="text" class="form-control" id="fileExtensions" value="pdf" placeholder="e.g., pdf, doc, docx">
                                        <div class="form-text">File extensions to look for during scraping.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Max Link Depth</label>
                                        <input type="number" class="form-control" id="maxDepth" value="2" min="1" max="10">
                                        <div class="form-text">How deep to follow links from each page (1-10).</div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="followLinks" checked>
                                            <label class="form-check-label" for="followLinks">
                                                Follow Links on Pages
                                            </label>
                                        </div>
                                        <div class="form-text">Follow links to find more PDFs on the same site.</div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="extractDirectories" checked>
                                            <label class="form-check-label" for="extractDirectories">
                                                Extract from PDF Directories
                                            </label>
                                        </div>
                                        <div class="form-text">Detect and extract from directories containing multiple PDFs.</div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="skipDuplicates" checked>
                                            <label class="form-check-label" for="skipDuplicates">
                                                Skip Duplicate URLs
                                            </label>
                                        </div>
                                        <div class="form-text">Skip URLs that have been scraped before.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Min File Size (MB)</label>
                                        <input type="number" class="form-control" id="minFileSizeMb" min="0" step="0.1" placeholder="e.g., 0.5">
                                        <div class="form-text">Minimum file size in MB (optional).</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Max File Size (MB)</label>
                                        <input type="number" class="form-control" id="maxFileSizeMb" min="0" step="0.1" placeholder="e.g., 50">
                                        <div class="form-text">Maximum file size in MB (optional).</div>
                                    </div>
                                </div>
                                <!-- Regular Search Fields -->
                                <div id="searchQueryFields">
                                    <div class="mb-3">
                                        <label class="form-label">Search Query</label>
                                        <input type="text" class="form-control" id="searchQuery" value="service manual filetype:pdf -preview -operator -operation -user" placeholder="e.g., vintage camera manual filetype:pdf">
                                        <div class="form-text">Edit this query to customize your search. The default excludes preview, operator, operation, and user manuals.</div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Max Results</label>
                                    <input type="number" class="form-control" id="maxResults" value="100" min="1" max="200">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Search Terms (comma-separated)</label>
                                    <input type="text" class="form-control" id="searchTerms" value="service manual, repair manual, workshop manual, service station manual, technical manual, maintenance manual, diagnostic manual, troubleshooting guide" placeholder="e.g., service manual, repair manual, workshop manual">
                                    <div class="form-text">These terms help identify relevant documents during scraping.</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Exclude Terms (comma-separated)</label>
                                    <input type="text" class="form-control" id="excludeTerms" value="preview, operator, operation, user manual, owner's manual, quick start guide, brochure, catalog, sample pages" placeholder="e.g., preview, operator, user manual">
                                    <div class="form-text">Documents containing these terms will be filtered out.</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Minimum PDF Pages</label>
                                    <input type="number" class="form-control" id="minPages" value="5" min="1" max="500">
                                    <div class="form-text">Only PDFs with at least this many pages will be included (helps exclude previews).</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Traversal Pattern</label>
                                    <textarea class="form-control" id="traversalPattern" rows="2" placeholder="e.g., Follow links containing: download, manual, service">Follow links containing: download, manual, service, repair, workshop, technical, maintenance, diagnostic, troubleshooting, document, repository, archive, directory</textarea>
                                    <div class="form-text">Pattern for finding PDF links on web pages during traversal.</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Schedule (Optional)</label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <input type="datetime-local" class="form-control" id="scheduleTime">
                                        </div>
                                        <div class="col-md-6">
                                            <select class="form-select" id="scheduleFrequency">
                                                <option value="">Run Once</option>
                                                <option value="daily">Daily</option>
                                                <option value="weekly">Weekly</option>
                                                <option value="monthly">Monthly</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-text">Leave empty to run immediately (queued)</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Equipment Type (Optional)</label>
                                    <input type="text" class="form-control" id="equipmentType" placeholder="e.g., Camera, Radio, etc.">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Manufacturer (Optional)</label>
                                    <input type="text" class="form-control" id="manufacturer" placeholder="e.g., Canon, Nikon, etc.">
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="autostartEnabled">
                                        <label class="form-check-label" for="autostartEnabled">
                                            <i class="bi bi-play-circle"></i> Enable Autostart
                                        </label>
                                        <div class="form-text">Automatically start the next job in queue when this job completes</div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!-- AI Generation Tab -->
                        <div class="tab-pane fade" id="ai" role="tabpanel">
                            <form id="aiJobForm">
                                <div class="mb-3">
                                    <label class="form-label">Job Name</label>
                                    <input type="text" class="form-control" id="aiJobName" value="Service Manuals Collection" placeholder="e.g., Vintage Camera Manuals">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Describe what you want to scrape</label>
                                    <textarea class="form-control" id="aiPrompt" rows="5" placeholder="e.g., I want to find vintage camera service manuals from the 1970s, specifically for Canon and Nikon cameras. Look for PDF files on manual sites and forums. Get about 100 results. Focus on service manuals, repair manuals, workshop manuals, service station manuals, technical manuals, maintenance manuals, diagnostic manuals, and troubleshooting guides. Exclude operator, operation, user manuals, owner's manuals, quick start guides, brochures, catalogs, and sample pages. Only include PDFs longer than 5 pages.">Find comprehensive service manuals for equipment. The AI will generate a multi-site scraping configuration that searches across approximately 100 websites to discover as many service manuals as possible. It will focus on service manuals, repair manuals, workshop manuals, service station manuals, technical manuals, maintenance manuals, diagnostic manuals, and troubleshooting guides. It will exclude preview PDFs, operator manuals, operation manuals, user manuals, owner's manuals, quick start guides, brochures, catalogs, and sample pages. Only PDFs with more than 5 pages will be included. The scraper will traverse through multiple sites to find document repositories, file directories, and manual archives.</textarea>
                                    <div class="form-text">Edit this description to customize what the AI generates for your search.</div>
                                </div>
                                <button type="button" class="btn btn-primary w-100" id="generateConfigBtn" onclick="generateScrapeConfig()">
                                    <i class="bi bi-magic"></i> Generate Configuration
                                </button>
                                <div id="aiLoading" class="text-center mt-3" style="display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-2 text-muted">Generating configuration with AI...</p>
                                </div>
                                <div id="aiResult" class="mt-3" style="display: none;">
                                    <div class="alert alert-success">
                                        <h6><i class="bi bi-check-circle"></i> Configuration Generated!</h6>
                                        <p class="mb-0">Review and adjust the settings below, then click "Create Job".</p>
                                    </div>
                                    <hr>
                                    <h6>Generated Settings:</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Job Name</label>
                                        <input type="text" class="form-control" id="aiGeneratedJobName">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Source Type</label>
                                        <select class="form-select" id="aiGeneratedSourceType">
                                            <option value="multi_site" selected>Multi-Site Scraper (DuckDuckGo + Traversal)</option>
                                            <option value="search">Search Engine</option>
                                            <option value="forum">Forums</option>
                                            <option value="manual_site">Manual Sites</option>
                                            <option value="gdrive">Google Drive</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Search Query</label>
                                        <input type="text" class="form-control" id="aiGeneratedQuery">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Max Results</label>
                                        <input type="number" class="form-control" id="aiGeneratedMaxResults" min="1" max="200">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Search Terms (comma-separated)</label>
                                        <input type="text" class="form-control" id="aiGeneratedSearchTerms">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Exclude Terms (comma-separated)</label>
                                        <input type="text" class="form-control" id="aiGeneratedExcludeTerms">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Minimum PDF Pages</label>
                                        <input type="number" class="form-control" id="aiGeneratedMinPages" min="1" max="500">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Traversal Pattern</label>
                                        <textarea class="form-control" id="aiGeneratedTraversalPattern" rows="2"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Equipment Type</label>
                                        <input type="text" class="form-control" id="aiGeneratedEquipmentType">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Manufacturer</label>
                                        <input type="text" class="form-control" id="aiGeneratedManufacturer">
                                    </div>
                                    <!-- Advanced Settings -->
                                    <hr>
                                    <h6>Advanced Settings</h6>
                                    <div id="aiMultiSiteFields" style="display: block;">
                                        <div class="mb-3">
                                            <label class="form-label">Additional Sites to Scrape (one per line, optional)</label>
                                            <textarea class="form-control" id="aiGeneratedSites" rows="4" placeholder="https://example.com/manuals&#10;https://another-site.com/documents&#10;https://manual-archive.com"></textarea>
                                            <div class="form-text">Enter additional URLs to scrape. The scraper will crawl each site concurrently along with sites found from DuckDuckGo.</div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">File Extensions (comma-separated)</label>
                                            <input type="text" class="form-control" id="aiGeneratedFileExtensions" value="pdf" placeholder="e.g., pdf, doc, docx">
                                            <div class="form-text">File extensions to look for during scraping.</div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Max Link Depth</label>
                                            <input type="number" class="form-control" id="aiGeneratedMaxDepth" value="2" min="1" max="10">
                                            <div class="form-text">How deep to follow links from each page (1-10).</div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="aiGeneratedFollowLinks" checked>
                                                <label class="form-check-label" for="aiGeneratedFollowLinks">
                                                    Follow Links on Pages
                                                </label>
                                            </div>
                                            <div class="form-text">Follow links to find more PDFs on the same site.</div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="aiGeneratedExtractDirectories" checked>
                                                <label class="form-check-label" for="aiGeneratedExtractDirectories">
                                                    Extract from PDF Directories
                                                </label>
                                            </div>
                                            <div class="form-text">Detect and extract from directories containing multiple PDFs.</div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="aiGeneratedSkipDuplicates" checked>
                                                <label class="form-check-label" for="aiGeneratedSkipDuplicates">
                                                    Skip Duplicate URLs
                                                </label>
                                            </div>
                                            <div class="form-text">Skip URLs that have been scraped before.</div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Min File Size (MB)</label>
                                            <input type="number" class="form-control" id="aiGeneratedMinFileSizeMb" min="0" step="0.1" placeholder="e.g., 0.5">
                                            <div class="form-text">Minimum file size in MB (optional).</div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Max File Size (MB)</label>
                                            <input type="number" class="form-control" id="aiGeneratedMaxFileSizeMb" min="0" step="0.1" placeholder="e.g., 50">
                                            <div class="form-text">Maximum file size in MB (optional).</div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Max PDF Pages</label>
                                            <input type="number" class="form-control" id="aiGeneratedMaxPages" min="1" max="500" placeholder="e.g., 500">
                                            <div class="form-text">Maximum number of PDF pages (optional).</div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="aiGeneratedAutostartEnabled">
                                            <label class="form-check-label" for="aiGeneratedAutostartEnabled">
                                                <i class="bi bi-play-circle"></i> Enable Autostart
                                            </label>
                                            <div class="form-text">Automatically start the next job in queue when this job completes</div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Schedule (Optional)</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input type="datetime-local" class="form-control" id="aiGeneratedScheduleTime">
                                            </div>
                                            <div class="col-md-6">
                                                <select class="form-select" id="aiGeneratedScheduleFrequency">
                                                    <option value="">Run Once</option>
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly">Weekly</option>
                                                    <option value="monthly">Monthly</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-text">Leave empty to run immediately (queued)</div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createScrapeJob()">
                        <i class="bi bi-plus-lg"></i> Create Job
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Job Modal -->
    <div class="modal fade" id="editJobModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-pencil"></i> Edit Scrape Job</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="editJobStatusAlert" class="alert alert-warning" style="display: none;">
                        <i class="bi bi-exclamation-triangle"></i> <span id="editJobStatusMessage"></span>
                    </div>
                    <form id="editJobForm">
                        <input type="hidden" id="editJobId">

                        <!-- Basic Settings -->
                        <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-gear"></i> Basic Settings</h6>
                        <div class="mb-3">
                            <label class="form-label">Job Name</label>
                            <input type="text" class="form-control" id="editJobName">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Source Type</label>
                            <select class="form-select" id="editSourceType" onchange="toggleEditMultiSiteFields()">
                                <option value="multi_site">Multi-Site Scraper (DuckDuckGo + Traversal)</option>
                                <option value="search">Search Engine</option>
                                <option value="forum">Forums</option>
                                <option value="manual_site">Manual Sites</option>
                                <option value="gdrive">Google Drive</option>
                            </select>
                        </div>

                        <!-- Multi-Site Fields -->
                        <div id="editMultiSiteFields">
                            <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-diagram-3"></i> Multi-Site Settings</h6>
                            <div class="mb-3">
                                <label class="form-label">DuckDuckGo Search Query</label>
                                <input type="text" class="form-control" id="editDdgSearchQuery">
                                <div class="form-text">DuckDuckGo will find sites, then we'll traverse them for PDFs.</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Additional Sites (one per line)</label>
                                <textarea class="form-control" id="editSites" rows="3"></textarea>
                            </div>
                        </div>

                        <!-- Search & Filter Settings -->
                        <h6 class="border-bottom pb-2 mb-3 mt-4"><i class="bi bi-funnel"></i> Search & Filter Settings</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Max Results</label>
                                    <input type="number" class="form-control" id="editMaxResults" min="1" max="200">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">File Extensions</label>
                                    <input type="text" class="form-control" id="editFileExtensions" value="pdf">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Search Terms (comma-separated)</label>
                            <input type="text" class="form-control" id="editSearchTerms">
                            <div class="form-text">Terms that must appear in URL or title.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Exclude Terms (comma-separated)</label>
                            <input type="text" class="form-control" id="editExcludeTerms">
                            <div class="form-text">Documents with these terms will be filtered out.</div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Min Pages</label>
                                    <input type="number" class="form-control" id="editMinPages" min="1">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Max Pages</label>
                                    <input type="number" class="form-control" id="editMaxPages" min="1">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Max Link Depth</label>
                                    <input type="number" class="form-control" id="editMaxDepth" min="1" max="10">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Min File Size (MB)</label>
                                    <input type="number" class="form-control" id="editMinFileSizeMb" min="0" step="0.1">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Max File Size (MB)</label>
                                    <input type="number" class="form-control" id="editMaxFileSizeMb" min="0" step="0.1">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3 form-check">
                                    <input class="form-check-input" type="checkbox" id="editFollowLinks">
                                    <label class="form-check-label" for="editFollowLinks">Follow Links</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3 form-check">
                                    <input class="form-check-input" type="checkbox" id="editExtractDirectories">
                                    <label class="form-check-label" for="editExtractDirectories">Extract Directories</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3 form-check">
                                    <input class="form-check-input" type="checkbox" id="editSkipDuplicates">
                                    <label class="form-check-label" for="editSkipDuplicates">Skip Duplicates</label>
                                </div>
                            </div>
                        </div>

                        <!-- Categorization -->
                        <h6 class="border-bottom pb-2 mb-3 mt-4"><i class="bi bi-tags"></i> Categorization</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Equipment Type</label>
                                    <input type="text" class="form-control" id="editEquipmentType">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Manufacturer</label>
                                    <input type="text" class="form-control" id="editManufacturer">
                                </div>
                            </div>
                        </div>

                        <!-- Scheduling -->
                        <h6 class="border-bottom pb-2 mb-3 mt-4"><i class="bi bi-clock"></i> Scheduling</h6>
                        <div class="mb-3">
                            <label class="form-label">Schedule (Optional)</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="datetime-local" class="form-control" id="editScheduleTime">
                                </div>
                                <div class="col-md-6">
                                    <select class="form-select" id="editScheduleFrequency">
                                        <option value="">Run Once</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input class="form-check-input" type="checkbox" id="editAutostartEnabled">
                            <label class="form-check-label" for="editAutostartEnabled">
                                <i class="bi bi-play-circle"></i> Enable Autostart
                            </label>
                            <div class="form-text">Auto-start next job in queue when this job completes.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateScrapeJob()">
                        <i class="bi bi-check-lg"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Details Modal -->
    <div class="modal fade" id="jobDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-info-circle"></i> Job Details & Logs</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Job Configuration -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-gear"></i> Configuration</h6>
                        <div id="jobConfigDetails" class="row">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Job Logs -->
                    <div>
                        <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-terminal"></i> Console Logs</h6>
                        <div id="jobLogsContainer" class="scrape-logs" style="max-height: 400px; overflow-y: auto;">
                            <div class="text-muted">No logs available.</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="cloneFromDetailsBtn">
                        <i class="bi bi-copy"></i> Clone This Job
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/scrape-queue.js"></script>
</body>
</html>
